"use strict";function t(t){t.headers=t.header;return my.request?my.request(t):my.httpRequest(t)}function e(e){try{t(e)}catch(t){Y().e("请求失败: "+t)}}function n(t){return ft.encode(t,!1)}function i(t){return ft.decode(t)}function r(t){for(var e="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(t);i++)e+=n[Math.round(Math.random()*(n.length-1))];return e}function o(t){return!Number.isNaN(parseInt(t,10))}function a(t,e){for(var n=String(t).split("."),i=String(e).split("."),r=0;r<Math.max(n.length,i.length);r++){var o=parseInt(n[r]||0,10),a=parseInt(i[r]||0,10);if(o>a)return 1;if(o<a)return-1}return 0}function c(t){return JSON.parse(JSON.stringify(t))}function u(t,e){return!(!t||!e||0===e.length||e.length>t.length)&&t.substr(0,e.length)===e}function s(t,e){return!(!e||0===t.length||e.length>t.length)&&t.substring(t.length-e.length)===e}function f(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}function p(t,e){if(t===e)return!0;if(t&&"object"==typeof t&&e&&"object"==typeof e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t){if(Object.prototype.hasOwnProperty.call(e,n))return!1;if(!p(t[n],e[n]))return!1}return!0}return!1}function l(t,e){if(!t)return"";if("string"==typeof e&&e.length){var n=new RegExp("^"+e+"*");t=t.replace(n,"")}else t=t.replace(/^s*/,"");return t}function h(t,e){if(!t)return"";var n,i;if("string"==typeof e&&e.length){n=new RegExp(e);i=t.length;for(;n.test(t.charAt(i));)i-=1;return t.slice(0,i+1)}n=/s/;i=t.length-1;for(;n.test(t.charAt(i));)i-=1;return t.slice(0,i+1)}function d(t){var e=null;switch(t){case Ot.HALF_SESSION:e=g();break;case Ot.CLOSE_SESSION:e=v();break;case Ot.EKV:e=y()}return e}function g(){var t=null,e=Lt().cloneCurrentSession();e&&(t={header:{st:"1"},analytics:{sessions:[e]}});return t}function v(){var t=null,e={},n=Lt().cloneCurrentSession();if(n){var i=W().get(),r=dt().get();Array.isArray(i)&&i.length&&(n.pages=pt.clone(i));Array.isArray(r)&&r.length&&(n.shares=pt.clone(r));W().clear();dt().clear();e.sessions=[n]}var o=_t().getEkvs();if(o){e.ekvs=pt.clone(o);_t().clear()}(e.sessions||e.ekvs)&&(t={analytics:e});return t}function y(){var t=null,e=_t().getEkvs();if(e){t={analytics:{ekvs:pt.clone(e)}};_t().clear()}return t}function _(t){return{h:m(t.header,Pt),a:I(t.analytics,kt)}}function m(t,e){var n=E(t,e);t.id_tracking&&(n[e.id_tracking||"id_tracking"]=E(t.id_tracking,wt));return n}function E(t,e){var n={};for(var i in t)e[i]?n[e[i]]=t[i]:n[i]=t[i];return n}function I(t,e){var n={};if(t)for(var i in t)t[i]&&(n[e[i]]=t[i]);return n}function S(t,n,i,r){Rt.instance().setIdType(lt().getIdType());Rt.instance().setIdTracking(lt().getIdTracking());var o=lt().getUserId();o&&t.analytics&&(t.analytics.active_user={puid:o,provider:lt().getProvider()});var a=pt.clone(Rt.instance().get());t.header=pt.assign(a,t.header,{ts:Date.now(),testToken:bt().getToken(),traceId:pt.getRandomStr(10)+Date.now()+pt.getRandomStr(9)});var c=_(t),u=K.stringify(c),s={url:X.LOG_URL,method:"POST",data:pt.base64Encode(u),success:function(e){var r=e.code||e.status||e.statusCode;if(200===r||413===r){Y().i("数据发送成功: ",t,u);A((e.data||{}).imprint);"function"==typeof n&&n(e)}else{Y().w("数据发送失败: ",u);"function"==typeof i&&i()}},fail:function(t){Y().w("超时: ",u);"function"==typeof i&&i()},complete:function(){"function"==typeof r&&r()}};e(pt.assign(s,N()))}function A(t){if(t){G().set(X.IMPRINT,t);Rt.instance().setItem(X.IMPRINT,t);var e=K.parse(pt.base64Decode(t));Y().v("imprint: %o",e);var n=e.report_policy;if(n&&pt.isNumber(n)){G().set(X.REPORT_POLICY,n);if(n===X.REPORT_POLICY_INTERVAL){var i=e.report_interval;if(i&&pt.isNumber(i)){i<=X.EVENT_SEND_MIN_INTERVAL?i=X.EVENT_SEND_MIN_INTERVAL:i>X.EVENT_SEND_MAX_INTERVAL&&(i=X.EVENT_SEND_MAX_INTERVAL);G().set(X.REPORT_INTERVAL_TIME,i)}}}e.ttn_invalid&&bt().clear()}}function N(){;"alipaymp/json";return{header:{"Content-Type":"alipaymp/json","Msg-Type":"alipaymp/json"}}}function T(t){var e=t,n=[];this.enqueue=function(t){"number"==typeof e&&this.size()>=e&&this.dequeue();n.push(t)};this.dequeue=function(){return n.shift()};this.front=function(){return n[0]};this.isEmpty=function(){return 0===n.length};this.clear=function(){n.length=0};this.size=function(){return n.length};this.items=function(){return n};this.print=function(){console.log(n.toString())}}function R(t,e){this.id=t;this.ts=Date.now();var n=typeof e;if("string"===n&&e)this[t]=e;else if("object"===n)for(var i in e)({}).hasOwnProperty.call(e,i)&&(this[i]=e[i])}function O(){function t(){lt().init(function(){Rt.instance().init();Y().v("Header初始化成功")});e()}function e(){try{my.on("alipayAuthChange",function(t){t&&t.data&&t.data.authcode&&Rt.instance().updateExtraInfo()})}catch(t){Y().e("绑定auth change异常: ",t)}}function n(t,e){return"number"!=typeof a||"number"!=typeof e||(a<=0||t-a>e)}function i(t,e){if(!t||"string"!=typeof t){Y().e('please check trackEvent id. id should be "string" and not null');return!1}var n=["id","ts","du"],i={};n.forEach(function(t){i[t]=1});if(i[t]){Y().e("eventId不能与以下保留字冲突: "+n.join(","));return!1}if(t.length>X.MAX_EVENTID_LENGTH){Y().e("The maximum length of event id shall not exceed "+X.MAX_EVENTID_LENGTH);return!1}if(e&&("object"!=typeof e||Array.isArray(e))&&"string"!=typeof e){Y().e("please check trackEvent properties. properties should be string or object(not include Array)");return!1}if("object"==typeof e){var r=0;for(var o in e)if({}.hasOwnProperty.call(e,o)){if(o.length>X.MAX_PROPERTY_KEY_LENGTH){Y().e("The maximum length of property key shall not exceed "+X.MAX_PROPERTY_KEY_LENGTH);return!1}if(r>=X.MAX_PROPERTY_KEYS_COUNT){Y().e("The maximum count of properties shall not exceed "+X.MAX_PROPERTY_KEYS_COUNT);return!1}if(i[o]){Y().e("属性中的key不能与以下保留字冲突: "+n.join(","));return!1}r+=1}}return!0}var r=!1,o=!1,a=0;this.init=function(e){Y().v("sdk version: "+X.IMPL_VERSION);r?Y().v("Lib重复实例化"):G().load(function(){Y().v("cache初始化成功: ",G().getAll());t();r=!0;"function"==typeof e&&e();Y().tip("SDK集成成功")})};this.resume=function(t){if(r&&!o){Y().v("showOptions: ",t);o=!0;var e=Lt().resume(t),n=Lt().getCurrentSessionId();_t().setSessionId(n);bt().init(function(){Ct().load();e&&Ct().add(Ot.HALF_SESSION,{},function(){Ct().send()})})}};this.pause=function(){if(r){o=!1;a=0;Lt().pause();H().uploadUserInfo()&&Mt().update();Ct().send(Ot.CLOSE_SESSION,{},function(){Ct().save();G().save();Y().v("cache save success")})}};this.setOpenid=function(t){Y().v("setOpenId: %s",t);lt().setOpenid(t);Ct().send()};this.setUnionid=function(t){Y().v("setUnionid: %s",t);lt().setUnionid(t)};this.setUserid=function(t,e){Y().v("setUserid: %s",t,e);lt().setUserid(t,e)};this.trackEvent=function(t,e){if(r){Y().v("event: ",t,e);if(i(t,e)){var o=new R(t,e);_t().addEvent(o);var c=!!bt().getToken(),u=c?0:X.EVENT_SEND_DEFAULT_INTERVAL,s=Date.now();if(n(s,u)){a=s;Ct().send(Ot.EKV,{noCache:c},function(){})}}}};this.trackShare=function(t){if(r){try{t=dt().add(t);Y().v("sharePath: ",t.path)}catch(t){Y().v("shareAppMessage: ",t)}return t}};this.trackPageStart=function(t){r&&W().addPageStart(t)};this.trackPageEnd=function(t){r&&W().addPageEnd(t)}}function L(){}function k(t,n){if(t>=xt.length||n){n&&P();n&&Y().v("命中可用服务",xt[jt]);!n&&Y().tip_w("未命中可用服务");return!1}e({url:xt[t]+"/uminiprogram_logs/ckdh",success:function(e){if(200===(e.code||e.status||e.statusCode)&&e.data&&200===e.data.code){jt=t;k(t+1,!0)}else k(t+1,!1)},fail:function(){k(t+1,!1)}})}function P(){var t="https://umini.shujupie.com";X.LOG_URL=X.LOG_URL.replace(t,xt[jt]);X.GET_OPENID_URL=X.GET_OPENID_URL.replace(t,xt[jt]);X.USERINFO_URL=X.USERINFO_URL.replace(t,xt[jt])}function w(t){setTimeout(()=>{k(0,!1)},t)}function U(t,e,n){var i=t[e];t[e]=function(t){n.call(this,t);i&&i.call(this,t)}}function D(t){try{Gt.init(t)}catch(t){Y().v("onAppLaunch: ",t)}}function b(t){try{Yt=t?pt.clone(t):{};Y().v("App onShow: ",t,Yt)}catch(t){Y().v("onAppShow: ",t)}}function C(){try{Gt.pause()}catch(t){Y().v("onAppHide: ",t)}}function M(t){try{if(t){Yt.query=Yt.query||{};pt.assign(Yt.query,t)}Y().v("Page onLoad: ",t,Yt)}catch(t){Y().v("onPageLoad: ",t)}}function V(){try{Gt.resume(Yt);Gt.trackPageStart(this.route)}catch(t){Y().v("onPageShow: ",t)}}function x(){try{Gt.trackPageEnd(this.route)}catch(t){Y().v("onPageHide: ",t)}}var j="[UMENG] -- ",Y=function(){function t(){this.setDebug=function(t){n=t};this.d=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=j+arguments[0]);console.debug.apply(console,arguments)}catch(t){}};this.i=function(){try{if(n)try{"string"==typeof arguments[0]&&(arguments[0]=j+arguments[0]);console.info.apply(console,arguments)}catch(t){}}catch(t){}};this.e=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=j+arguments[0]);console.error.apply(console,arguments)}catch(t){}};this.w=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=j+arguments[0]);console.warn.apply(console,arguments)}catch(t){}};this.v=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=j+arguments[0]);console.log.apply(console,arguments)}catch(t){}};this.t=function(){if(n)try{console.table.apply(console,arguments)}catch(t){}};this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]=j+arguments[0]);console.log.apply(console,arguments)}catch(t){}};this.tip_w=function(t){try{console.log("%c "+j+t,"background:red; padding: 4px; padding-right: 8px; border-radius: 4px; color: #fff;")}catch(t){}};this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]=j+arguments[0]);console.error.apply(console,arguments)}catch(t){}}}var e=null,n=!1;return function(){null===e&&(e=new t);return e}}(),F={set:function(t,e,n){var i,r={key:t,success:function(t){"function"==typeof n&&n(t)},fail:function(){"function"==typeof n&&n()}};r.data=e;i=my.setStorage;try{i&&i(r)}catch(t){Y.e("存储错误",t)}},get:function(t,e){var n;n=my.getStorage;try{n&&n({key:t,success:function(t){"function"==typeof e&&e(t.data)},fail:function(n){Y().w(t+": "+n.errMsg);"function"==typeof e&&e()}})}catch(t){Y.e("获取storage错误",t)}},remove:function(t,e){var n;n=my.removeStorage;try{n&&n({key:t,success:function(){"function"==typeof e&&e(!0)},fail:function(){"function"==typeof e&&e(!1)}})}catch(t){Y.e("删除storage错误",t)}}},K={stringify:function(t){if(t)try{return JSON.stringify(t)}catch(t){}return""},parse:function(t){if(t)try{return JSON.parse(t)}catch(t){}return null},parseToArray:function(t){if(t)try{return JSON.parse(t)}catch(t){}return[]}},H=function(){function t(){var t={};this.appKey=function(){return t.appKey};this.uploadUserInfo=function(){return t.uploadUserInfo};this.set=function(e){t=e};this.get=function(){return t};this.setItem=function(e,n){t[e]=n};this.getItem=function(e){return t[e]}}var e=null;return function(){e||(e=new t);return e}}(),G=function(){function t(){this.load=function(t){if(i){F.remove(n);t()}else{n="um_cache_"+H().appKey();F.get(n,function(e){i=K.parse(e)||{};r=!0;F.remove(n);t()})}};this.save=function(){i&&F.set(n,K.stringify(i))};this.set=function(t,e){i&&(i[t]=e)};this.get=function(t){return(i||{})[t]};this.remove=function(t){i&&i[t]&&delete i[t]};this.getAll=function(){return i};this.clear=function(){i=null};this.has=function(t){return!!this.get(t)};this.isLoaded=function(){return r}}var e=null,n="",i=null,r=!1;return function(){e||(e=new t);return e}}(),q="",X={SESSION_INTERVAL:3e4,LOG_URL:q="https://umini.shujupie.com/alipaym_logs",GET_OPENID_URL:"https://umini.shujupie.com/uminiprogram_logs/wx/getuut",USERINFO_URL:"https://umini.shujupie.com/uminiprogram_logs/comm/uif",DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",CURRENT_SESSION:"current_session",SESSION_PAUSE_TIME:"session_pause_time",EVENT_SEND_DEFAULT_INTERVAL:15e3,EVENT_LAST_SEND_TIME:"last_send_time",MAX_EVENTID_LENGTH:128,MAX_PROPERTY_KEY_LENGTH:256,MAX_PROPERTY_KEYS_COUNT:100,REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT:"imprint",SEED_VERSION:"1.0.0",IMPL_VERSION:"2.3.5",ALIPAY_AVAILABLE_VERSION:"10.1.52",SHARE_PATH:"um_share_path",SHARES:"shares",REQUESTS:"requests",UUID:"um_uuid",UUID_SUFFIX:"ud",OPENID:"um_od",UNIONID:"um_unid",ALIPAYID:"um_alipayid",USERID:"um_userid",PROVIDER:"um_provider",LAUNCH_OPTIONS:"LAUNCH_OPTIONS",UM_SSRC:"_um_ssrc",USER_INFO:"user_info",IS_ALIYUN:!1,ALIYUN_URL:"serverless.huoban.youmeng.network.forward"},J={getUserInfo:function(t){my.getSetting({success:function(e){e.authSetting.userInfo?my.getOpenUserInfo({success:e=>{let n=JSON.parse(e.response).response;t({userInfo:n})},fail:function(){t({})}}):t({})},fail:function(){t({})}})},getSystemInfo:function(t,e){my.getSystemInfo({success:function(e){"function"==typeof t&&t(e)},fail:function(){"function"==typeof e&&e()}})},getDeviceInfo:function(t){try{my.call("getDeviceInfo",{},function(e){var n=(e||{}).data;if(n){G().set(X.DEVICE_INFO_KEY,n);"function"==typeof t&&t(n)}else{var i=G().get(X.DEVICE_INFO_KEY);"function"==typeof t&&t(i)}})}catch(t){Y().w("支付宝获取设备info 失败",t)}},checkNetworkAvailable:function(t){var e={success:function(e){var n=!1;n=e.networkAvailable;"function"==typeof t&&t(n)},fail:function(){"function"==typeof t&&t()}};my.getNetworkType(e)},getNetworkInfo:function(t,e){var n={success:function(e){"function"==typeof t&&t(e)},fail:function(){"function"==typeof e&&e()}};my.getNetworkType(n)},getDeviceId:function(t,e){try{"function"==typeof t&&t("")}catch(t){Y().e("getDeviceId error",t)}},getAdvertisingId:function(t,e){"function"==typeof t&&t("")},getPageName:function(){},onNetworkStatusChange:function(t){my.onNetworkStatusChange(function(e){"function"==typeof t&&t(e.isConnected||!0)})}},W=function(){function t(){var t=!1,e=null,n=[];this.addPageStart=function(n){if(n&&!t){e={ts:Date.now(),path:n,page_name:n};t=!0}};this.addPageEnd=function(i){if(t&&i&&e&&i===e.page_name){var r=Date.now()-e.ts;e.duration=Math.abs(r);n.push(e);e=null;t=!1}};this.get=function(){return n};this.getCurrentPage=function(){return e};this.clear=function(){n.length=0}}var e=null;return function(){e||(e=new t);return e}}(),z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",B=function(t){for(var e={},n=0,i=t.length;n<i;n++)e[t.charAt(n)]=n;return e}(z),Q=String.fromCharCode,Z=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?Q(192|e>>>6)+Q(128|63&e):Q(224|e>>>12&15)+Q(128|e>>>6&63)+Q(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return Q(240|e>>>18&7)+Q(128|e>>>12&63)+Q(128|e>>>6&63)+Q(128|63&e)},$=function(t){return t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Z)},tt=function(t){var e=[0,2,1][t.length%3],n=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[z.charAt(n>>>18),z.charAt(n>>>12&63),e>=2?"=":z.charAt(n>>>6&63),e>=1?"=":z.charAt(63&n)].join("")},et=function(t){return t.replace(/[\s\S]{1,3}/g,tt)},nt=function(t){return et($(t))},it=function(t,e){return e?nt(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):nt(String(t))},rt=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),ot=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return Q(55296+(e>>>10))+Q(56320+(1023&e));case 3:return Q((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return Q((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},at=function(t){return t.replace(rt,ot)},ct=function(t){var e=t.length,n=e%4,i=(e>0?B[t.charAt(0)]<<18:0)|(e>1?B[t.charAt(1)]<<12:0)|(e>2?B[t.charAt(2)]<<6:0)|(e>3?B[t.charAt(3)]:0),r=[Q(i>>>16),Q(i>>>8&255),Q(255&i)];r.length-=[0,0,2,1][n];return r.join("")},ut=function(t){return t.replace(/[\s\S]{1,4}/g,ct)},st=function(t){return at(ut(t))},ft={encode:it,decode:function(t){return st(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}},pt={base64Encode:n,base64Decode:i,isNumber:o,compareVersion:a,getRandomStr:r,clone:c,startsWith:u,endsWith:s,assign:f,deepEqual:p,trimStart:l,trimEnd:h},lt=function(){function t(){function t(t){try{my.call("getOpenUserData",{},function(e){var n=(e||{}).uid;n||Y().err('请确保已经勾选支付宝功能包中的"友盟+数据服务"功能包！');"function"==typeof t&&t(n)})}catch(e){t("")}}var e="",n="",i="",r="",o="",a="";this.init=function(e){a="alipay_id";F.get(X.ALIPAYID,function(n){if(n){o=n;e&&e()}else t(function(t){Y().v("获取到alipayid: %s",t);o=t;F.set(X.ALIPAYID,o);e&&e()})})};F.get(X.USERID,function(t){!i&&t&&(i=t)});F.get(X.PROVIDER,function(t){!r&&t&&(r=t)});this.getIdType=function(){return a};this.getIdTracking=function(){var t={};e&&(t.openid=e);n&&(t.unionid=n);o&&(t.alipay_id=o);i&&(t.userid=i);return t};this.setOpenid=function(t){if(t&&t!==e){e=t;F.set(X.OPENID,t)}};this.setUnionid=function(t){if(!n&&t){n=t;F.set(X.UNIONID,t)}};this.setUserid=function(t,e){if(t&&t!==i){i=t;F.set(X.USERID,t);r=e;F.set(X.PROVIDER,e)}};this.getId=function(){return o};this.getUserId=function(){return i};this.getProvider=function(){return r}}var e=null;return function(){e||(e=new t);return e}}(),ht=3,dt=function(){function t(){return{add:function(t){Y().v("share origin: %o",t);var e={title:t&&t.title,path:t&&t.path&&t.path.split("?")[0],_um_sts:Date.now()};e.path&&e.path.length>1&&pt.startsWith(e.path,"/")&&(e.path=pt.trimStart(e.path,"/"));var r=t.path||"",o=lt().getId();if(o){var a=i.split(","),c=(a=a.filter(function(t){return t.length>0})).indexOf(o);c>=0&&(a=a.slice(0,c));a.length<ht&&a.push(o);var u=a.join(",");-1!==r.indexOf("?")?r+="&_um_ssrc="+u:r+="?_um_ssrc="+u;var s=Date.now();r+="&_um_sts="+s;t.path=r;e._um_ssrc=u;e._um_sts=s}n.push(e);Y().v("share: %o",t);return t},setShareSource:function(t){i=t},clear:function(){n.length=0},get:function(){return n}}}var e=null,n=[],i="";return function(){e||(e=new t);return e}}(),gt="ekvs",vt=1e4,yt=1,_t=function(){function t(){if(a.length){var t=G().get(gt);if(n(t)+a.length<=vt){t=e(t,a);G().set(gt,t)}}}function e(t,e){var n=(t=t||{})[o];Array.isArray(n)&&n.length?t[o]=n.concat(e):t[o]=[].concat(e);return t}function n(t){var e=0;for(var n in t)Array.isArray(t[n])&&(e+=t[n].length);return e}function i(){return{addEvent:function(e){if(o){a.unshift(e);if(a.length>yt){t(o);a.length=0}}else{Y().w("session id is null: ",o);c.unshift(e)}},setSessionId:function(t){o=t;Y().v("setSessionId: ",o);if(Array.isArray(c)&&c.length&&o){for(var e=0;e<c.length;e++)this.addEvent(c[e]);c.length=0}},getEkvs:function(){var t=G().get(gt);a&&a.length&&(t=e(t,a));return t},clear:function(){G().remove(gt);a.length=0}}}var r,o,a=[],c=[];return function(){r||(r=i());return r}}(),mt={getClipboard:function(t){var e;e=my.getClipboard;try{e&&e({success:function(e){var n=e.text;"function"==typeof t&&t(n)},fail:function(){"function"==typeof t&&t("")}})}catch(t){Y.e("读取clipboard发生错误",t)}},showModal:function(t){var e;e=my.confirm;t.confirmButtonText=t.confirmText;t.cancelButtonText=t.cancelText;try{e&&e(t)}catch(t){Y.e("展示Modal时发生错误",t)}},showToast:function(t){var e;e=my.showToast;t.content=t.title;try{e&&e(t)}catch(t){Y.e("showToast error",t)}},getUserInfo:function(t){var e,n={fail:function(){t&&t()}};e=my.getOpenUserInfo;n.success=function(e){try{var n=JSON.parse(e.response).response;n&&t&&t({avatar:n.avatar,nickName:n.nickName,gender:n.gender,country:n.countryCode,province:n.province,city:n.city})}catch(e){t()}};try{e&&e(n)}catch(t){Y.e("showToast error",t)}},getAppInfoSync:function(){return{appId:my.getAppIdSync?my.getAppIdSync():""}}},Et="2g",It="3g",St="4g",At="none",Nt=" ",Tt=["access","access_subtype"],Rt=function(){function t(){function t(t){J.getSystemInfo(function(i){J.getNetworkInfo(function(o){var a=(o=o||{}).type||o.networkType;a===At&&(a="unknown");var c=G().get(X.IMPRINT);c&&(r.imprint=c);e(i,a);n(i);t&&t()})})}function e(t,e,n){r.userInfo=n;r.device_type="Phone";r.sdk_version=X.IMPL_VERSION;r.appkey=H().appKey();if(t){var i,o,a,c=t.model||"",u=(t.product,t.platform||""),s=t.brand||"",f=s.toLowerCase();r.platform_version=t.version;if("android"===u){i=Math.round(t.screenWidth);o=Math.round(t.screenHeight)}else{i=Math.round(t.screenWidth*t.pixelRatio);o=Math.round(t.screenHeight*t.pixelRatio)}a=i>o?i+"*"+o:o+"*"+i;r.os=u;r.font_size_setting=t.fontSizeSetting;r.device_model=c;r.device_brand=s;r.device_manufacturer=f;r.device_manuid=c.toLowerCase().indexOf(f)>-1?c:f+Nt+c;r.device_name=c.toLowerCase().indexOf(f)>-1?c:f+Nt+c;r.os_version=t.system;r.resolution=a;r.language=t.language}switch(e=e?e.toLowerCase():""){case St:r.access_subtype="LTE";r.access="4G";break;case It:r.access_subtype="CDMA";r.access="3G";break;case Et:r.access_subtype="GRPS";r.access="2G";break;default:r.access=e;delete r.access_subtype}}function n(t){var e=[];if(t){e.push({name:"系统名",value:t.platform});e.push({name:"支付宝版本号",value:t.version})}e.push({name:"设备型号",value:r.device_model});e.push({name:"设备生产商",value:r.device_brand});e.push({name:"os版本号",value:r.os_version});e.push({name:"网络类型",value:r.access});e.push({name:"运营商",value:r.access_subtype});e.push({name:"分辨率",value:r.resolution});e.push({name:"screenWidth",value:t.screenWidth});e.push({name:"screenHeight",value:t.screenHeight});e.push({name:"pixelRatio",value:t.pixelRatio});for(var n="",i=0;i<e.length;i++){var o=e[i];n+=o.name+": "+o.value+"; "}Y().v("调试辅助信息: ",n)}var i=!1,r={};r.sdk_type="alipaymp";r.platform="alipay";r.platform_sdk_version=my.SDKVersion;var o=mt.getAppInfoSync();r.appid=o.appId;r.app_env=o.appEnv;r.app_version=o.appVersion;return{init:function(){this.updateExtraInfo();t(function(){i=!0})},isLoaded:function(){return i},get:function(){return r},getSDKType:function(){return r.sdk_type},getPlatform:function(){return r.platform},getRealtimeFields:function(){var t={};Tt.forEach(function(e){t[e]=r[e]});return t},setIdTracking:function(t){this.setItem("id_tracking",t)},setIdType:function(t){this.setItem("id_type",t)},setItem:function(t,e){r[t]=e},getItem:function(t){return r[t]},updateExtraInfo:function(){J.getDeviceInfo(function(t){r.device_info=t||""})}}}var e=null;return{instance:function(){e||(e=t());return e}}}(),Ot={HALF_SESSION:"half_session",CLOSE_SESSION:"close_session",EKV:"ekv",ENTER_PAGE:"enter_page",LEAVE_PAGE:"leave_page"},Lt=function(){function t(){return{resume:function(t){var e=!1;a||(a=G().get(X.CURRENT_SESSION));var i=new Date;o=i.getTime();if(!a||!a.end_time||o-a.end_time>X.SESSION_INTERVAL){e=!0;n(t);Y().v("开始新的session(%s): ",a.id,a)}else Y().v("延续上一次session(%s): %s ",a.id,i.toLocaleTimeString(),a);return e},pause:function(){i()},getCurrentSessionId:function(){return(a||{}).id},getCurrentSession:function(){return a},cloneCurrentSession:function(){return pt.clone(a)}}}function e(t){var e={};for(var n in t)0===n.indexOf("_um_")&&(e[n]=t[n]);return e}function n(t){try{var n=(a||{}).options||{},i=pt.assign({},e(t.query));i.path=t.path||n.path;i.scene=t.scene?Rt.instance().getPlatform()+"_"+t.scene:n.scene;var r=t.referrerInfo;r&&(i.referrerAppId=r.appId);Y().v("session options: ",i);var o=i[X.UM_SSRC];o&&dt().setShareSource(o);var c=Date.now();a={id:pt.getRandomStr(10)+c,start_time:c,options:i}}catch(t){Y().e("生成新session失败: ",t)}}function i(){if(a){var t=new Date;a.end_time=t.getTime();"number"!=typeof a.duration&&(a.duration=0);a.duration=a.end_time-o;G().set(X.CURRENT_SESSION,a);Y().v("退出会话(%s): %s ",a.id,t.toLocaleTimeString(),a)}}var r=null,o=null,a=null;return function(){r||(r=t());return r}}(),kt={sessions:"sn",ekvs:"e",active_user:"active_user"},Pt={sdk_type:"sdt",access:"ac",access_subtype:"acs",device_model:"dm",language:"lang",device_type:"dt",device_manufacturer:"dmf",device_name:"dn",platform_version:"pv",id_type:"it",font_size_setting:"fss",os_version:"ov",device_manuid:"did",platform_sdk_version:"psv",device_brand:"db",appkey:"ak",_id:"id",id_tracking:"itr",imprint:"imp",sdk_version:"sv",resolution:"rl",testToken:"ttn"},wt={uuid:"ud",unionid:"und",openid:"od",alipay_id:"ad",device_id:"dd",userid:"puid"},Ut="_UMTEST_",Dt="TEST_TOKEN",bt=function(){function t(){this.init=function(t){mt.getClipboard(function(e){n=G().get(Dt);try{if(e&&pt.startsWith(e,Ut)&&e.split(Ut)[1]){var i=e.split(Ut)[1],r=JSON.parse(i).token;if(r){n=r;G().set(Dt,r)}}}catch(t){Y().v(t)}t(!!n)})};this.getToken=function(){return n};this.clear=function(){n="";G().remove(Dt)}}var e=null,n="";return function(){e||(e=new t);return e}}(),Ct=function(){function t(e,n,i){if(Rt.instance().isLoaded()){n=n||{};var r=d(e);if(r){var o=Rt.instance().getRealtimeFields();r.header=pt.assign({},r.header,o);r.noCache=n.noCache;u.enqueue(r)}"function"==typeof i&&i()}else setTimeout(function(){t(e,n,i)},100)}function e(t){var i=u.front(),r=function(){u.dequeue();e(t)},o=function(){var n=u.dequeue();n&&!n.noCache&&c.push(n);e(t)};if(i)S(i,r,o);else{n();t()}}function n(){c.forEach(function(t){u.enqueue(t)});c.length=0}function i(t){if(lt().getId())if(a)Y().i("队列正在发送中");else{a=!0;e(function(){a=!1;"function"==typeof t&&t()})}else{Y().i("获取id标识失败，暂缓发送");"function"==typeof t&&t()}}function r(){this.send=function(t,e,n){t?this.add(t,e,function(){i(n)}):i(n)};this.add=function(e,n,i){t(e,n,i)};this.load=function(){var t=G().get(X.REQUESTS);t&&t.length&&t.forEach(function(t){u.enqueue(t)});G().remove(X.REQUESTS)};this.save=function(){G().set(X.REQUESTS,pt.clone(u.items()));u.clear()}}var o=null,a=!1,c=[],u=new T(50);return function(){o||(o=new r);return o}}(),Mt=function(){function t(){function t(t,n){var i=H().appKey(),r=Rt.instance().getSDKType(),o=lt().getId(),a=lt().getIdType();if(i&&r&&o&&a){var c={ak:H().appKey(),sdt:Rt.instance().getSDKType(),uin:t.nickName,uia:t.avatar,uig:t.gender,uit:t.country,uip:t.province,uic:t.city,uil:t.language,id:lt().getId(),it:lt().getIdType()},u=JSON.stringify(c);u=pt.base64Encode(u);e({url:X.USERINFO_URL,method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:"ui="+u,success:function(e){Y().v("用户信息上传成功: ",t);n&&n(e&&e.data&&200===e.data.code)},fail:function(){Y().e("用户信息上传失败: ",t);n&&n(!1)}})}}this.update=function(){mt.getUserInfo(function(e){if(e){var n=G().get(X.USER_INFO);n&&pt.deepEqual(e,n)||t(e,function(t){t&&G().set(X.USER_INFO,e)})}})}}var n=null;return function(){n||(n=new t);return n}}(),Vt=[];L.prototype={createMethod:function(t,e,n){try{t[e]=n?function(){return n[e].apply(n,arguments)}:function(){Vt.push([e,[].slice.call(arguments)])}}catch(t){Y().v("create method errror: ",t)}},installApi:function(t,e){try{var n,i,r=["resume","pause","trackEvent","trackPageStart","trackPageEnd","trackShare","setOpenid","setUnionid","setUserid"];for(n=0,i=r.length;n<i;n++)this.createMethod(t,r[n],e);if(e)for(n=0,i=Vt.length;n<i;n++){var o=Vt[n];try{e[o[0]].apply(e,o[1])}catch(t){Y().v("impl[v[0]].apply error: ",o[0],t)}}}catch(t){Y().v("install api errror: ",t)}}};var xt=["https://umini.shujupie.com","https://ulogs.umeng.com"],jt=0;({init:w}).init(3e3);var Yt={};try{var Ft=App;App=function(t){U(t,"onLaunch",function(){D(t.umengConfig)});U(t,"onShow",b);U(t,"onHide",C);if(t.onShareAppMessage){var e=t.onShareAppMessage;t.onShareAppMessage=function(t){var n=e.call(this,t);return Gt.trackShare.call(this,n)}}Ft(t)}}catch(t){Y().w("App重写异常")}try{var Kt=Page;Page=function(t){U(t,"onShow",V);U(t,"onHide",x);U(t,"onUnload",x);U(t,"onLoad",M);if(t.onShareAppMessage){var e=t.onShareAppMessage;t.onShareAppMessage=function(n){var i=e.call(this,n)||{};i.path=i.path||t.route;return Gt.trackShare.call(this,i)}}Kt(t)}}catch(t){Y().w("Page重写异常")}var Ht=new L,Gt={_inited:!1,init:function(t){function e(t){try{var e=new O;Y().v("成功创建Lib对象");e.init(function(){Y().v("Lib对象初始化成功");Ht.installApi(t,e);Y().v("安装Lib接口成功")})}catch(t){Y().w("创建Lib对象异常: "+t)}}Y().tip_w("2.3.2及之后版本需在微信后台更换域名白名单为: umini.shujupie.com");if(this._inited)Y().v("已经实例过，请避免重复初始化");else if(t)if(t.appKey){"boolean"!=typeof t.useOpenid&&(t.useOpenid=!0);H().set(t);Y().setDebug(t.debug);this._inited=!0;var n=this;J.getSystemInfo(function(t){t&&t.version&&"alipay"===t.app&&pt.compareVersion(t.version,X.ALIPAY_AVAILABLE_VERSION)<0?Y().err("只支持版本号大于等于10.1.52的支付宝客户端！"):e(n)})}else Y().err("请确保传入正确的appkey");else Y().err("请通过在App内添加umengConfig设置相关信息！")}};try{Ht.installApi(Gt,null);Y().v("安装临时接口成功");my.uma=Gt}catch(t){Y().w("uma赋值异常: ",t)}module.exports=Gt;
